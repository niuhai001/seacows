
cdh官方文档
https://docs.cloudera.com/documentation/enterprise/latest/topics/cdh_intro.html
修改主机名
hostnamectl set-hostname shuqi1
hostnamectl set-hostname shuqi2
hostnamectl set-hostname shuqi3
hostnamectl set-hostname shuqi4
配置hosts
cat >> /etc/hosts <<EOF
10.128.1.10 shuqi1
10.128.1.10 shuqi2
10.128.1.10 shuqi3
10.128.1.10 shuqi4
EOF
配置免密
ssh-keygen
ssh-copy-id 10.128.1.10
ssh-copy-id 10.128.1.10
ssh-copy-id 10.128.1.10
ssh-copy-id 10.128.1.10
下载地址
6.3.2
链接：https://pan.baidu.com/s/155VuPtJC8v7SC_HfzbSZ4Q
提取码：aa0c
6.3.1
链接 : https://pan.baidu.com/s/1uaCfCF9p0PLaxdm9mGeQgA   
提取码 : pdcb
关闭防火墙和selinux
systemctl stop firewalld
systemctl disable firewalld
[root@cm-server ~]# vim /etc/selinux/config
# 将SELINUX置为disabled
SELINUX=disabled
时间同步
ntpdate
vm.swappiness 参数可以调整机器使用内存、交互分区的比例。vm.swappiness 的取值范围在 0-100 之间，当 vm.swappiness 为 0 时，表示最大限度地使用物理内存，而后使用 swap 空间；当 swappiness 为 100 时，表示最大限度地使用 swap 空间，把内存中的数据及时搬运到 swap 空间中去。
# 各服务器节点均执行
vim /etc/sysctl.conf 
cat >> /etc/sysctl.conf << EOF
vm.swappiness = 0
EOF
sysctl -p #生效
大多数 Linux 平台都包含一个称为透明大页面的功能，该功能与 Hadoop 工作节点的交互很差，并且会严重降低性能。
查看透明大页是否启用，[always] never 表示已启用，always [never] 表示已禁用。
# 各服务器节点均执行
echo never > /sys/kernel/mm/transparent_hugepage/defrag
echo never > /sys/kernel/mm/transparent_hugepage/enabled

安装python2.7.5
cenots7默认就是python2
python -V
配置环境变量
vim /etc/profile.d/java.sh
# JAVA_HOME
export JAVA_HOME=/usr/java/default
export CLASSPATH=./:$JAVA_HOME/lib
export PATH=$JAVA_HOME/bin:$PATH

source /etc/profile.d/java.sh
java -version #验证
vi /opt/cloudera/cm/bin/cm-server   +130 #将自己的java路径放进去
vi /opt/cloudera/cm-agent/service/common/cloudera-config.sh +55 #将自己的java路径放进去

[图片]
进入到mysql的目录安装mysql
rpm -ivh 01_mysql-community-common-5.7.29-1.el7.x86_64.rpm
 rpm -ivh 02_mysql-community-libs-5.7.29-1.el7.x86_64.rpm 
rpm -ivh 03_mysql-community-libs-compat-5.7.29-1.el7.x86_64.rpm 
# 安装mysql-client
rpm -ivh 04_mysql-community-client-5.7.29-1.el7.x86_64.rpm
# 安装mysql-server
 rpm -ivh 05_mysql-community-server-5.7.29-1.el7.x86_64.rpm 

# 【注意】 安装过程中如果出现报错失败；大多都是因lib冲突，或者小版本依赖等问题，可以根据报错做如下一些常用的依赖清理和依赖处理
# 以下罗列常用的解决办法
# 库冲突：清理mysql-libs库
# [root@cm-server software]# yum remove mysql-libs
# 缺少依赖：安装libaio autoconf
# [root@cm-server software]# yum install -y libaio autoconf
# 提示mariadb相关的报错：删除mariadb的lib库
# [root@cm-server software]# rpm -qa | grep mariadb
# mariadb-libs-5.5.56-2.el7.x86_64
# [root@cm-server software]# rpm -e --nodeps mariadb-libs-5.5.56-2.el7.x86_64
如果都不行就直接yum -y install *.rpm
 mysql 5.7的yum源http://dev.mysql.com/get/mysql57-community-release-el7-8.noarch.rpm
数据库操作
5.7
systemctl start mysqld
cat /var/log/mysqld.log | grep password
set password=password("Wangt@123"); #修改密码
flush privileges;
source cdh_db.sql；将文件导入这里会报错，要先将里面的用户密码修改成mysql可以接受的密码
生产不要动测式
set global validate_password_length=4; 修改密码策略
set global validate_password_policy=0;
修改user表，把Host表内容修改为% , 扩大数据库登录范围
update user set host="%" where user="root";

# 其它各agent节点创建java文件目录
[root@agent01 ~]# mkdir -p /usr/share/java
 JDBC 驱动包到指定目录
cp mysql-connector-java-8.0.20.jar /usr/share/java/mysql-connector-java.jar
scp mysql-connector-java-8.0.20.jar agent01:/usr/share/java/mysql-connector-java.jar 
 
# server端上安装自己选一个节点
yum install -y cloudera-manager-daemons-6.3.1-1466458.el7.x86_64.rpm
yum install -y cloudera-manager-server-6.3.1-1466458.el7.x86_64.rpm
 
 
 安装Clouder Manager Agent( agent )
scp cloudera-manager-agent-6.3.1-1466458.el7.x86_64.rpm agent01:~/
scp cloudera-manager-agent-6.3.1-1466458.el7.x86_64.rpm agent02:~/
 scp cloudera-manager-agent-6.3.1-1466458.el7.x86_64.rpm agent03:~/
 scp cloudera-manager-daemons-6.3.1-1466458.el7.x86_64.rpm agent01:~/
scp cloudera-manager-daemons-6.3.1-1466458.el7.x86_64.rpm agent02:~/
 scp cloudera-manager-daemons-6.3.1-1466458.el7.x86_64.rpm agent03:~/

安装agent
yum install -y cloudera-manager-daemons-6.3.1-1466458.el7.x86_64.rpm
yum install -y cloudera-manager-agent-6.3.1-1466458.el7.x86_64.rpm

修改agent的主机名
vim /etc/cloudera-scm-agent/config.ini
# 将server_host的配置改为server的主机名 [ 主机名是自己环境的server的host主机名 ]
server_host=cm-server
对库进行初始化
/opt/cloudera/cm/schema/scm_prepare_database.sh -h 10.128.1.70 mysql scm scm R00t@1298
将源拷贝到repo仓库
cp /opt/software/CDH-6.3.2-1.cdh6.3.2.p0.1605554-el7.parcel /opt/cloudera/parcel-repo/
cp /opt/software/CDH-6.3.2-1.cdh6.3.2.p0.1605554-el7.parcel.sha /opt/cloudera/parcel-repo/

这里启动的时候要修改启动脚本
vi /opt/cloudera/cm/bin/cm-server   +130 #将自己的java路径放进去
vi /opt/cloudera/cm-agent/service/common/cloudera-config.sh +55 #将自己的java路径放进去
/opt/third/jdk1.8.0_241
# cm-server
systemctl start cloudera-scm-server
 systemctl enable cloudera-scm-server
# 所有节点cm-server和各agent
[root@cm-server software]# systemctl start cloudera-scm-agent
[root@cm-server software]# systemctl enable cloudera-scm-agent

页面访问&集群安装
http:cm-serverIP:7180 （ admin / admin ）
如果找不见 Parcel 
把权限修改一下
看/opt/cloudera/parcel-repo/
CDH-6.3.2-1.cdh6.3.2.p0.1605554-el7.parcel 
CDH-6.3.2-1.cdh6.3.2.p0.1605554-el7.parcel.sha
CDH-6.3.2-1.cdh6.3.2.p0.1605554-el7.parcel.sha256
manifest.json

页面安装集群教程如下：
[图片]
选择cm的版本
[图片]
输入自定义集群名称
[图片]
[图片]
CDHparcel的版本
[图片]
检查服务器部署环境
[图片]
如果错误是java版本的问题请选择：
[图片]
集群设置：
[图片]
角色分配
集群节点角色分配一下（这些服务是自定义服务）一般默认就可以，如果有其他需求可以自行调试
[图片]
集群数据库配置，这个忘记密码可以参考导入数据库中的sql文件
[图片]
如果测试连接失败，请先看scm-server的日志，显示的问题是什么，我这边是java环境的问题
在页面将java环境配置 主机>>>主机名称>>>配置>>>搜索（java）可以看到java的目录
shuqi1：tail -f /var/log/cloudera-scm-server/cloudera-scm-server.log
集群数据存放目录设置（有其他需求可以调整）
[图片]
集群组件安装
[图片]
需要在集群中主机配置java环境
如果有报错，请查看完整日志我的报错java环境配置错误
服务安装完成
[图片]
cdh安装的hadoop环境变量如下（以下可以不做，在deploy用户中.bashrc中将hadoop的打开就可以使用）
export HADOOP_CLASSPATH=`hadoop classpath`
export HADOOP_HOME=/opt/cloudera/parcels/CDH/lib/hadoop 
export HADOOP_CONF_DIR /etc/hadoop/conf
export HADOOP_COMMON_HOME /opt/cloudera/parcels/CDH/lib/hadoop 
export HADOOP_HDFS_HOME /opt/cloudera/parcels/CDH/lib/hadoop-hdfs
export HADOOP_MAPRED_HOME /opt/cloudera/parcels/CDH/lib/hadoop-mapreduce

